{% extends "base.html" %}

{% block title %}
  <h1>Sales Tracker</h1>
{% endblock title %}

{% block content %}
  <h3>Know your salary precisely (for {{ current_user.name }})</h3>
  <div class="content">
    
        <form action="{{ url_for('main.index') }}" method="POST" class="sale-form">
      <label for="sale_date">Date:</label>
      <input type="date" name="sale_date" value="{{ datetime.now().strftime('%Y-%m-%d') }}" required>
    {# NOTE: Changed datetime.utcnow() to datetime.now() for consistency #}

      <label for="sale_amount">Amount:</label>
      <input type="number" step="0.01" name="sale_amount" required>

      <label for="sale_type">Type:</label>
      <select name="sale_type" required>
        <option value="sale">Sale</option>
        <option value="presentation">Presentation</option>
      </select>

      <button type="submit">Add Sale</button>
    </form>
    
    <hr>
    
    <h4>This month:</h4>
    <p>Total Sales: {{ sales_total }}</p>
    <p>Total Presentations: {{ presentations_total }}</p>
    
    <hr>

    {% if sales|length < 1 %}
      <h4>There are no sales yet for this user.</h4>
    {% else %}
    
    <table>
      <tr>
        <th>Date</th>
        <th>Amount</th>
        <th>Type</th>
        <th>Commission</th>
        <th>Actions</th>
      </tr>
      {% for sale in sales %}
        <tr>
          <td>{{ sale.sale_date.date() }}</td>
          <td>{{ sale.sale_amount }}</td>
          <td>{{ sale.sale_type }}</td>
          <td>{{ sale.commission }}</td>
          <td>
                            <a href="{{ url_for('main.delete_sale', id=sale.id) }}">Delete</a> | 
            <a href="{{ url_for('main.update_sale', id=sale.id) }}">Update</a>
          </td>
        </tr>
      {% endfor %}
    </table>
    {% endif %}

  </div>
{% endblock content %}